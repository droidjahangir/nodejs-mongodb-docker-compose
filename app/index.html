<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CRUD Application</title>
  </head>
  <body>
    <h1>CRUD Application</h1>

    <h2>Add New Item</h2>
    <form id="addProductForm">
      <label for="itemName">Product Name:</label>
      <input type="text" id="itemName" required />
      <button type="submit">Add product</button>
    </form>

    <h2>All Products</h2>
    <ul id="itemList"></ul>

    <script>
      // Function to fetch and display all items
      async function fetchItems() {
        try {
          const response = await fetch('/v1/product/all');
          const items = await response.json();

          const itemList = document.getElementById('itemList');
          itemList.innerHTML = '';

          items.forEach((item) => {
            const li = document.createElement('li');
            li.innerHTML = `${item.name} <button onclick="editItem('${item._id}', '${item.name}')">Edit</button> <button onclick="deleteItem('${item._id}')">Delete</button>`;
            itemList.appendChild(li);
          });
        } catch (error) {
          console.error('Error fetching products:', error);
        }
      }

      // Function to add a new product
      async function addItem(event) {
        event.preventDefault();
        const form = event.target;
        const itemName = form.elements.itemName.value;

        try {
          const response = await fetch('/v1/product/create', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ name: itemName }),
          });

          if (response.ok) {
            form.reset();
            fetchItems();
          } else {
            console.error('Error adding product:', response.statusText);
          }
        } catch (error) {
          console.error('Error adding product:', error);
        }
      }

      // Function to edit an item
      async function editItem(itemId, itemName) {
        const updatedName = prompt('Enter the updated name:', itemName);

        if (updatedName !== null) {
          try {
            const response = await fetch('/v1/product/update/', {
              method: 'PUT',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ name: updatedName, id: itemId }),
            });

            if (response.ok) {
              fetchItems();
            } else {
              console.error('Error updating product:', response.statusText);
            }
          } catch (error) {
            console.error('Error updating product:', error);
          }
        }
      }

      // Function to delete an item
      async function deleteItem(itemId) {
        const confirmation = confirm(
          'Are you sure you want to delete this product?'
        );

        if (confirmation) {
          try {
            const response = await fetch(`/v1/product/delete/?${itemId}`, {
              method: 'DELETE',
            });

            if (response.ok) {
              fetchItems();
            } else {
              console.error('Error deleting product:', response.statusText);
            }
          } catch (error) {
            console.error('Error deleting product:', error);
          }
        }
      }

      // Add event listener to the form
      document
        .getElementById('addItemForm')
        .addEventListener('submit', addItem);

      // Fetch items when the page loads
      fetchItems();
    </script>
  </body>
</html>
